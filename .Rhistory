ds2<-NAHilator(ds)
ds2
head(ds2)
write.csv(ds2, file="NAhilator.r")
getwd()
write.csv(ds2, file="DHSWaiverdata-prepared for SAS Coxph.csv")
ds<-read.csv("S:/CCAN/CCANResEval/Title IV-E Waiver/DHS Data/kahd_72152_FY2012-FY2013/derived/joins_for_sas/aocs_client_removed-2014-11-16a.csv")
NAhilator<-function(x){
for(i in 1:ncol(x)){
x[,i]<-as.character(x[,i])
x[,i]<-ifelse(is.na(as.character(x[,i]))==TRUE, c("."), x[,i])
}
return(x)
}
ds2<-NAhilator(ds)
ds3<-ds2
ds3[,ds3$ReunificationWithin6Months]<-ifelse(ds3$ReunificationWithin6Months==TRUE, 1, 0)
ds3[,ds3$ReunificationWithin6Months]
break
escape
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==TRUE, 1, 0)
ds3$ReunificationWithin6Months
sum(ds$Reunificationwithin6Months)
length(ds$Reunificationwithin6Months)
ds$ReunificationWithin6Months
length(ds$Reunificationwithin6Months)
ncol(ds$Reunificationwithin6Months)
sum(ds$Reunificationwithin6Months)
ds3$ReunificationWithin6Months
ds$Reunificationwithin6Months
ds<-read.csv("S:/CCAN/CCANResEval/Title IV-E Waiver/DHS Data/kahd_72152_FY2012-FY2013/derived/joins_for_sas/aocs_client_removed-2014-11-16a.csv")
ds$Reunificationwithin6Months
length(ds$Reunificationwithin6Months)
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==c("TRUE"), 1, 0)
ds3$ReunificationWithin6Months
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==TRUE), 1, 0)
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==TRUE, 1, 0)
ds$Reunificationwithin6Months
names(ds)
length(ds[,47])
sum(ds[,47])
sum(is.na((ds[,47]))
)
sum(is.na(ds3[,47]))
ds3[,47]
ds3[,ds3$ReunificationWithin6Months]<-ifelse(ds3$ReunificationWithin6Months==TRUE, 1, 0)
ds3<-ds2
ds3[,ds3$ReunificationWithin6Months]<-ifelse(ds3$ReunificationWithin6Months==TRUE, 1, 0)
break
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==TRUE, 1, 0)
ds3$ReunificationWithin6Months
length(ds[,47])
sum(is.na((ds[,47])))
length(ds3[,47])
sum(is.na((ds3[,47])))
ds3[,47]
length(ds[,47])
sum(is.na((ds[,47])))
length(ds3[,47])
sum((ds3[,47]))
names(ds3)
ds2<-NAhilator(ds)
ds3<-ds2
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==TRUE, 1, 0)
head(ds3)
length(ds3[,47])
sum(ds3[,47])
sum(is.na((ds[,47])))
length(ds[,47])
sum(ds[,47])
str(ds[,47])
mean(ds[,47])
str(ds3[,47])
length(ds2[,47])
sum(ds2[,47])
length(ds3[,47])
sum(ds3[,47])
str(ds2[,47])
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==c("TRUE"), 1, 0)
sum(ds3[,47])
ds3<-ds2
ds3$ReunificationWithin6Months<-ifelse(ds3$ReunificationWithin6Months==c("TRUE"), 1, 0)
sum(ds3[,47])
length(ds2[,47])
sum(ds2[,47])
length(ds[,47])
sum(ds[,47])
ds<-read.csv("S:/CCAN/CCANResEval/Title IV-E Waiver/DHS Data/kahd_72152_FY2012-FY2013/derived/joins_for_sas/aocs_client_removed-2014-11-16a.csv")
dsVets <- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/vets.dta")
names(dsVets)<-c("tx", "Large", "Adeno", "Small", "Squamous", "survt", "perf", "DisDur", "age", "priortx", "status")
head(dsVets)
nrow(dsVets)
test<-dsVets$Large + dsVets$Adeno + dsVets$Small + dsVets$Squamous
library(survival)
library(foreign)
dsVets <- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/vets.dta")
names(dsVets)<-c("tx", "Large", "Adeno", "Small", "Squamous", "survt", "perf", "DisDur", "age", "priortx", "status")
head(dsVets)
nrow(dsVets)
test<-dsVets$Large + dsVets$Adeno + dsVets$Small + dsVets$Squamous
coxphPractice1<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="efron")
coxphPractice1<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
summary(coxphPractice1)
cox.zph(coxphPractice1, transform="identity")
cox.zph(coxphPractice1, transform="rank")
dsVetsEventsOnly<-dsVets[dsVets$status=1,]
dsVetsEventsOnly<-dsVets[dsVets$status==1,]
head(dsVetsEventsOnly)
dsVets$status
dsVets <- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/vets.dta")
names(dsVets)<-c("tx", "Large", "Adeno", "Small", "Squamous", "survt", "perf", "DisDur", "age", "priortx", "status")
head(dsVets)
nrow(dsVetsEventsOnly)
summary(dsVets$status)
levels(dsVets$status)
level(dsVets$status)
factors(dsVets$status)
factor(dsVets$status)
coxphPractice1Events
dsVetsEvents<-dsVets[dsVets$status==1,]
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="breslow")
cox.zph(coxphPractice1Events, transform="rank")
?cox.zph()
cox.zph(coxphPractice1, transform="rank")
coxphPractice1<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
cox.zph(coxphPractice1, transform="rank")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1Events, transform="rank")
cox.zph(coxphPractice1Events, transform="identity")
cox.zph(coxphPractice1Events, transform="km")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Adeno+dsVetsEvents$Large+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1Events, transform="rank")
timerank<-rank(dsVetsEvents$survt, ties.method=c("average"))
dsvetsEvents<-cbind(dsVetsEvents, timerank)
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
dsvetsEvents<-cbind(dsVetsEvents, timerank)
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
timerank
dsvetsEvents<-cbind(dsVetsEvents, as.numeric(timerank))
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
class(timerank)
coxphPractice1Events<-coxph(Surv(as.numeric(dsVetsEvents$timerank), dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
nrows(dsVetsEvents)
nrow(dsVetsEvents)
length(timerank)
timerank<-as.numeric(timerank)
coxphPractice1Events<-coxph(Surv(as.numeric(dsVetsEvents$timerank), dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
class(dsVetsEvents$timerank)
dsvetsEvents
coxphPractice1Events<-coxph(Surv(as.numeric(dsVetsEvents$as.numeric(timerank)), dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$as.numeric(timerank), dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
dsvetsEvents<-cbind(dsVetsEvents, timerank)
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
dsVetsEvents
dsvetsEvents<-cbind(dsVetsEvents, timerank)
dsvetsEvents
dsVetsEvents<-cbind(dsVetsEvents, timerank)
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1, transform="rank")
dsVetsEvents<-dsVets[dsVets$status==1,]
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
dsVetsEvents<-cbind(dsVetsEvents, timerank)
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="efron")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$ranktime, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="breslow")
coxphPractice1Events<-coxph(Surv(dsVetsEvents$timerank, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="breslow")
cox.zph(coxphPractice1Events, transform="rank")
dsVets <- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/vets.dta")
names(dsVets)<-c("tx", "Large", "Adeno", "Small", "Squamous", "survt", "perf", "DisDur", "age", "priortx", "status")
coxphPractice1<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
dsVetsEvents<-dsVets[dsVets$status==1,]
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="breslow")
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1
cox.zph(coxphPractice1Events, transform="rank")
coxphPractice1
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="breslow")
coxphPractice1Events
methods(cox.zph)
edit(cox.zph)
?rank()
edit(cox.zph)
dsVetsEvents<-dsVets[dsVets$status==1,]
coxphPractice1Events<-coxph(Surv(dsVetsEvents$survt, dsVetsEvents$status==1)~dsVetsEvents$tx+dsVetsEvents$Large+dsVetsEvents$Adeno+dsVetsEvents$Small+dsVetsEvents$perf+dsVetsEvents$DisDur+dsVetsEvents$age+dsVetsEvents$priortx, ties="breslow")
cox.zph(coxphPractice1Events, transform="rank")
dsVetsEvents<-dsVets[dsVets$status==1,]
dsVetsEvents
dsVets
str(coxphPractice1)
coxphPractice1$surv
perfHigh<-ifelse(dsVets$perf>=50, 1,0)
dsVets<-cbind(dsVets, perfHigh)
perfHigh<-ifelse(dsVets$perf>=50, 1,0)
dsVets<-cbind(dsVets, perfHigh)
PracticeGraph7<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~1)~perHigh)
PracticeGraph7<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~1)~dsVets$perHigh)
coxphPractice77<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~1)~dsVets$perHigh)
coxphPractice77<-coxph(Surv(dsVets$survt, dsVets$status==1)~1)
coxphPractice7<-coxph(Surv(dsVets$survt, dsVets$status==1)~1)
survPractice7<-survfit(coxphPractice7~dsVets$perfHigh)
coxphPractice7
coxphPractice7<-coxph(Surv(dsVets$survt, dsVets$status==1)~1)
coxphPractice7
str(coxphPractice7)
coxphPractice7<-coxph(Surv(dsVets$survt, dsVets$status==1)~~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
coxphPractice7<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
survPractice7<-survfit(coxphPractice7~dsVets$perfHigh)
survPractice7<-survfit(coxphPractice7)
survPractice7$surv
dsVetsperfHigh<-dsVets[dsVets$perfHigh==1,]
dsVetsperfLow<-dsVets[dsVets$perfHigh==0,]
coxphVetperfHigh<-coxph(Surv(dsVetsperfHigh$survt, dsVetsperfLow$status==1)~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
coxphVetperfHigh<-coxph(Surv(dsVetsperfHigh$survt, dsVetsperfLow$status==1)~dsVetsperfHigh$tx+dsVetsperfHigh$Large+dsVetsperfHigh$Adeno+dsVetsperfHigh$Small+dsVetsperfHigh$DisDur+dsVetsperfHigh$age+dsVetsperfHigh$priortx, ties="breslow")
coxphVetperfHigh<-coxph(Surv(dsVetsperfHigh$survt, dsVetsperfHigh$status==1)~dsVetsperfHigh$tx+dsVetsperfHigh$Large+dsVetsperfHigh$Adeno+dsVetsperfHigh$Small+dsVetsperfHigh$DisDur+dsVetsperfHigh$age+dsVetsperfHigh$priortx, ties="breslow")
survperfHigh<-survfit(coxphVetperfHigh)
survperfHigh$surv
coxphVetperfLow<-coxph(Surv(dsVetsperfLow$survt, dsVetsperfLow$status==1)~dsVetsperfLow$tx+dsVetsperfLow$Large+dsVetsperfLow$Adeno+dsVetsperfLow$Small+dsVetsperfLow$DisDur+dsVetsperfLow$age+dsVetsperfLow$priortx, ties="breslow")
survperfLow<-survfit(coxphVetperfLow)
plot(-1*log(-1&log(survperfHigh$surv)))
plot(-1*log(-1&log(survperfLow$surv)))
coxphVetperfHigh<-coxph(Surv(dsVetsperfHigh$survt, dsVetsperfHigh$status==1)~1, ties="breslow")
survperfHigh<-survfit(coxphVetperfHigh)
plot(-1*log(-1&log(survperfHigh$surv)))
survperfHigh<-survfit(coxphVetperfHigh)
plot(-1*log(-1&log(survperfHigh$surv)))
coxphVetperfHigh<-coxph(Surv(dsVetsperfHigh$survt, dsVetsperfHigh$status==1)~1, ties="breslow")
survperfHigh<-survfit(coxphVetperfHigh)
summary(survperfHigh)
plot(-1*log(-1*log(survperfHigh$surv)))
plot(-1*log(-1*log(survperfLow$surv)))
coxphVetperfLow<-coxph(Surv(dsVetsperfLow$survt, dsVetsperfLow$status==1)~1, ties="breslow")
survperfLow<-survfit(coxphVetperfLow)
plot(-1*log(-1*log(survperfHigh$surv)))
par()
plot(-1*log(-1*log(survperfLow$surv)))
plot(-1*log(-1*log(survperfHigh$surv)))
par(new=TRUE)
plot(-1*log(-1*log(survperfLow$surv)))
coxphVetperfHigh<-coxph(Surv(dsVetsperfHigh$survt, dsVetsperfHigh$status==1)~dsVetsperfLow$tx+dsVetsperfLow$Large+dsVetsperfLow$Adeno+dsVetsperfLow$Small+dsVetsperfLow$DisDur+dsVetsperfLow$age+dsVetsperfLow$priortx, ties="breslow")
survperfHigh<-survfit(coxphVetperfHigh)
coxphVetperfHigh<-coxph(Surv(dsVetsperfHigh$survt, dsVetsperfHigh$status==1)~dsVetsperfHigh$tx+dsVetsperfHigh$Large+dsVetsperfHigh$Adeno+dsVetsperfHigh$Small+dsVetsperfHigh$DisDur+dsVetsperfHigh$age+dsVetsperfHigh$priortx, ties="breslow")
survperfHigh<-survfit(coxphVetperfHigh)
coxphVetperfLow<-coxph(Surv(dsVetsperfLow$survt, dsVetsperfLow$status==1)~dsVetsperfLow$tx+dsVetsperfLow$Large+dsVetsperfLow$Adeno+dsVetsperfLow$Small+dsVetsperfLow$DisDur+dsVetsperfLow$age+dsVetsperfLow$priortx, ties="breslow")
survperfLow<-survfit(coxphVetperfLow)
plot(-1*log(-1*log(survperfHigh$surv)))
par(new=TRUE)
plot(-1*log(-1*log(survperfLow$surv)))
survtest<-survfit(Surv(dsVets$survt, dsVets$status==1)~dsVetsperfHigh)
survtest<-survfit(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh)
plot(-1*log(-1*log(survtest$surv)))
survtest<-survfit(Surv(dsVets$survt, dsVets$status==1)~1)
plot(-1*log(-1*log(survtest$surv)))
survtest<-survfit(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh)
plot(-1*log(-1*log(survtest$surv)))
summary(dsVets$survt)
dsVets <- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/vets.dta")
names(dsVets)<-c("tx", "Large", "Adeno", "Small", "Squamous", "survt", "perf", "DisDur", "age", "priortx", "status")
survtest<-survfit(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh)
plot(-1*log(-1*log(survtest$surv)))
perfHigh<-ifelse(dsVets$perf>=50, 1,0)
dsVets<-cbind(dsVets, perfHigh)
survtest<-survfit(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh)
plot(-1*log(-1*log(survtest$surv)))
?plot()
plot(log(-1*log(survtest$surv)))
str(plot(log(-1*log(survtest$surv))))
plot(-1*log(-1*log(survtest$surv)))
plot(survtest, fun="cloglog", log=FALSE)
plot(survtest, fun="cloglog", log=TRUE)
plot(survtest, fun="cloglog", log=y)
plot(survtest, fun="cloglog", log="x")
plot(survtest, fun="cloglog")
plot(survtest, fun="cloglog", log="x")
plot(survtest, fun="cloglog", log=c("x"))
plot(survtest, fun="cloglog", log=FALSE)
plot(survtest, fun="cloglog", )
plot(survtest, fun="cloglog", log=TRUE)
plot(survtest, fun="cloglog", )
survtExpected<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh))
plot(survExpected, fun="cloglog")
survExpected<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh))
plot(survExpected, fun="cloglog")
plot(survExpected, fun="cloglog", conf.int=FALSE)
survExpected<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~1)~dsVets$perfHigh)
survExpected<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh)~dsVets$perfHigh)
survExpected<-survfit(coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh))
plot(survExpected, fun="cloglog", conf.int=FALSE)
coxphperfHigh<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh, ties="breslow")
coxphperfHigh$surv
coxphperfHigh<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$perfHigh, ties="breslow")
coxphperfHigh$surv
survExpected<-survfit(coxphperfHigh)
survExpected$surv
dsAddicts<- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/addicts.dta")
head(dsAddicts)
coxphTest1<-coxph(Surv(dsAddicts$survt, dsAddicts$status==1)~dsAddicts$Clinic+dsAddicts$Prison+dsAddicts$Dose, ties="breslow")
coxphTest1<-coxph(Surv(dsAddicts$survt, dsAddicts$status==1)~dsAddicts$clinic+dsAddicts$Prison+dsAddicts$Dose, ties="breslow")
coxphTest1<-coxph(Surv(dsAddicts$survt, dsAddicts$status==1)~dsAddicts$clinic+dsAddicts$prison+dsAddicts$dose, ties="breslow")
coxphTest1
dsAddictsEvents<-dsAddicts[dsAddicts$status==1,]
coxphTest1Events<-coxph(coxph(Surv(dsAddictsEventsEvents$survt, dsAddictsEventsEvents$status==1)~dsAddictsEventsEvents$clinic+dsAddictsEventsEvents$prison+dsAddictsEvents$dose, ties="breslow"))
coxphTest1Events<-coxph(coxph(Surv(dsAddictsEventsEvents$survt, dsAddictsEvents$status==1)~dsAddictsEventsEvents$clinic+dsAddictsEventsEvents$prison+dsAddictsEvents$dose, ties="breslow"))
coxphTest1Events<-coxph(coxph(Surv(dsAddictsEvents$survt, dsAddictsEvents$status==1)~dsAddictsEvents$clinic+dsAddictsEvents$prison+dsAddictsEvents$dose, ties="breslow"))
cox.zph(coxphTest1Events, transform="rank")
dsAddictsEvents
coxphTest1Events<-coxph(Surv(dsAddictsEvents$survt, dsAddictsEvents$status==1)~dsAddictsEvents$clinic+dsAddictsEvents$prison+dsAddictsEvents$dose, ties="breslow")
cox.zph(coxphTest1Events, transform="rank")
getwed()
getwd()
setwd("~/GitHub/SurvivalExercises")
write.csv(dsAddicts, "dsAddicts.csv")
coxphAddictsClinic<-coxph(Surv(dsAddicts$survt, dsAddicts$status==1)~dsAddicts$prison+dsAddicts$dose+strata(dsAddicts$clinic), ties="breslow")
coxphAddictsClinic
dsAddicts<- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/anderson.dta")
dsAnderson<- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/anderson.dta")
dsAnderson<- read.dta("http://web1.sph.emory.edu/dkleinb/allDatasets/surv2datasets/anderson.dta")
head(dsAnderson)
coxphPractice5<-coxph(Surv(dsAnderson$survt, dsAnderson$status==1)~dsAnderson$sex+dsAnderson$logwbc+dsAnderson$rx, ties="breslow")
coxphPractice5
cox.zph(coxphPractice5)
cox.zph(coxphPractice5, transform="rank")
coxphPractice1<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$tx+dsVets$Large+dsVets$Adeno+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
cox.zph(coxphPractice1)
write.csv(dsAnderson, "Anderson.csv")
coxphPractice4b<-coxph(Surv(dsVets$survt, dsVets$status==1)~dsVets$tx+dsVets$Small+dsVets$perf+dsVets$DisDur+dsVets$age+dsVets$priortx, ties="breslow")
coxphPractice4b
cox.zph(coxphPractice4b, transform="rank")
library(survival)
library(foreign)
setwd("~/GitHub")
dsAnderson<-read.csv("./SurvivalExercises/Andrew/dsAnderson.csv")
colnames(dsAnderson)<-c("subject", "survt", "status", "sex", "logWBC", "rx")
AndersonPh<-coxph(Surv(survt, status==1)~sex+logWBC+rx, data=dsAnderson, ties="breslow")
cox.zph(AndersonPh, transform="rank")
eventTimes <- unique(dsAnderson$survt[dsAnderson$status==1])
eventTimes <- eventTimes[order(eventTimes)]
require(plyr)
createPTable <- function(d){
dNew <- d
for(i in 1:length(eventTimes)){
dNew[i,] <- d
dNew[i,"r"] <- i
dNew[i,"tr"] <- eventTimes[i]
dNew[i,"dir"] <- ifelse(i==1,min(d$survt,eventTimes[i]),min(d$survt,eventTimes[i]) - eventTimes[i-1])
dNew[i,"yir"] <- 0
if(d$survt <= eventTimes[i]) {
if(d$status %in% 1) dNew[i,"yir"] <- 1
break
}
}
return(dNew)
}
ptProcessAnderson <- ddply(.data=dsAnderson,.variables=.(subject),.fun = createPTable)
Int1<-list()
length(Int1)<-length(ptProcessAnderson$survt)
for(i in 1:length(ptProcessAnderson$tr)){
Int1[i]<-ifelse(ptProcessAnderson$tr[i]<15, ptProcessAnderson$sex[i]*1, 0)
}
Int2<-list()
length(Int2)<-length(ptProcessAnderson$survt)
for(i in 1:length(ptProcessAnderson$tr)){
Int2[i]<-ifelse(ptProcessAnderson$tr[i]>=15, ptProcessAnderson$sex[i]*1, 0)
}
head(ptProcessAnderson)
ptProcessAnderson<-cbind(ptProcessAnderson, as.integer(unlist(Int1)), as.integer(unlist(Int2)))
colnames(ptProcessAnderson)<-c("subject", "survt", "status", "sex", "logWBC", "rx","r", "tr", "dir", "yir", "Int1", "Int2")
poissonAndersos5<-glm(yir ~ I(as.factor(r)) + logWBC + rx + Int1 + Int2 + offset(I(log(dir))), family=poisson(link = "log"), data=ptProcessAnderson)
poissonAnderson8<-glm(yir ~ I(as.factor(r)) + sex + logWBC + rx + sex*tr + offset(I(log(dir))), family=poisson(link = "log"), data=ptProcessAnderson)
summary(poissonAnderson8)
poissonAnderson8<-glm(yir ~ I(as.factor(r)) + sex + logWBC + rx + sex:tr + offset(I(log(dir))), family=poisson(link = "log"), data=ptProcessAnderson)
summary(poissonAnderson8)
dsChemo<-read.csv("./SurvivalExercises/Andrew/dsChemo.csv")
colnames(dsChemo)<-c("subject", "rx", "status", "survt")
#1) A plot of the log-log Kaplan-Meier curves for each
#   treatment group is shown below. Based on this plot, what
#   would you conclude about the PH assumption regarding
#   the treatment group variable? Explain.
#   scurveChemo<-survfit(Surv(survt, status==1)~rx, data=dsChemo)
#   summary(scurveChemo)
scurveChemo<-survfit(Surv(survt, status==1)~rx, data=dsChemo)
summary(scurveChemo)
plot(scurveChemo)
ChemoPh<-coxph(Surv(survt, status==1)~rx, data=dsChemo, ties="breslow")
cox.zph(ChemoPh, transform="rank")
eventTimes <- unique(dsChemo$survt[dsChemo$status==1])
eventTimes <- eventTimes[order(eventTimes)]
createPTable <- function(d){
dNew <- d
for(i in 1:length(eventTimes)){
dNew[i,] <- d
dNew[i,"r"] <- i
dNew[i,"tr"] <- eventTimes[i]
dNew[i,"dir"] <- ifelse(i==1,min(d$survt,eventTimes[i]),min(d$survt,eventTimes[i]) - eventTimes[i-1])
dNew[i,"yir"] <- 0
if(d$survt <= eventTimes[i]) {
if(d$status %in% 1) dNew[i,"yir"] <- 1
break
}
}
return(dNew)
}
ptProcessChemo <- ddply(.data=dsChemo,.variables=.(subject),.fun = createPTable)
head(ptProcessChemo)
Tx1<-list()
length(Tx1)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx1[i]<-ifelse(ptProcessChemo$tr[i]<250, ptProcessChemo$rx*1, 0)
}
Tx2<-list()
length(Tx2)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx2[i]<-ifelse(250<=ptProcessChemo$tr[i] & ptProcessChemo$tr[i]<500, ptProcessChemo$rx*1, 0)
}
Tx3<-list()
length(Tx3)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx3[i]<-ifelse(ptProcessChemo$tr[i]>=500, ptProcessChemo$rx*1, 0)
}
ptProcessChemo<-cbind(ptProcessChemo, as.numeric(unlist(Tx1)),  as.numeric(unlist(Tx2)),  as.numeric(unlist(Tx3)))
colnames(ptProcessChemo)<-c("subject", "rx", "status", "survt", "r", "tr", "dir", "yir","Time1", "Time2", "Time3")
head(ptProcessChemo)
poissonChemo3<-glm(yir ~ I(as.factor(r)) + Time1 + Time2 + Time3 + offset(I(log(dir))), family=poisson(link = "log"), data=ptProcessChemo)
summary(poissonChemo3)
View(ptProcessChemo)
unique(ptProcessChemo$Time1[ptProcessChemo$survt < 250])
unique(ptProcessChemo$rx[ptProcessChemo$survt < 250])
Tx1<-list()
length(Tx1)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx1[i]<-ifelse(ptProcessChemo$tr[i]<250, ptProcessChemo$rx[i]*1, 0)
}
Tx2<-list()
length(Tx2)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx2[i]<-ifelse(250<=ptProcessChemo$tr[i] & ptProcessChemo$tr[i]<500, ptProcessChemo$rx[i]*1, 0)
}
Tx3<-list()
length(Tx3)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx3[i]<-ifelse(ptProcessChemo$tr[i]>=500, ptProcessChemo$rx[i]*1, 0)
}
ptProcessChemo<-cbind(ptProcessChemo, as.numeric(unlist(Tx1)),  as.numeric(unlist(Tx2)),  as.numeric(unlist(Tx3)))
colnames(ptProcessChemo)<-c("subject", "rx", "status", "survt", "r", "tr", "dir", "yir","Time1", "Time2", "Time3")
head(ptProcessChemo)
poissonChemo3<-glm(yir ~ I(as.factor(r)) + Time1 + Time2 + Time3 + offset(I(log(dir))), family=poisson(link = "log"), data=ptProcessChemo)
summary(poissonChemo3)
unique(ptProcessChemo$Time1[ptProcessChemo$survt < 250])
length(ptProcessChemo$rx
)
Tx1
i
ptProcessChemo$tr[i]
ptProcessChemo$tr[i]<250
ptProcessChemo$rx[i]
ifelse(ptProcessChemo$tr[i]<250, ptProcessChemo$rx[i]*1, 0)
unique(ptProcessChemo$Time1[ptProcessChemo$tr < 250])
unique(ptProcessChemo$rx[ptProcessChemo$tr < 250])
ifelse(ptProcessChemo$tr[i]<250, ptProcessChemo$rx[i]*1, 0)
View(ptProcessChemo)
table(ptProcessChemo$rx)
ptProcessChemo[ptProcessChemo$rx %in% 2,]
head(ptProcessChemo[ptProcessChemo$rx %in% 2,])
i <- 1733
ptProcessChemo$tr[i]
ptProcessChemo$rx[i]
ptProcessChemo$rx[i]*1
ifelse(ptProcessChemo$tr[i]<250, ptProcessChemo$rx[i]*1, 0)
Tx1[i]
as.numeric(unlist(Tx1))[i]
ptProcessChemo <- ddply(.data=dsChemo,.variables=.(subject),.fun = createPTable)
head(ptProcessChemo)
Tx1<-list()
length(Tx1)<-length(ptProcessChemo$yir)
table(ptProcessChemo$rx)
head(ptProcessChemo[ptProcessChemo$rx %in% 2,])
for(i in 1:length(ptProcessChemo$rx)){
Tx1[i]<-ifelse(ptProcessChemo$tr[i]<250, ptProcessChemo$rx[i]*1, 0)
}
as.numeric(unlist(Tx1))[i]
Tx2<-list()
length(Tx2)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx2[i]<-ifelse(250<=ptProcessChemo$tr[i] & ptProcessChemo$tr[i]<500, ptProcessChemo$rx[i]*1, 0)
}
Tx3<-list()
length(Tx3)<-length(ptProcessChemo$yir)
for(i in 1:length(ptProcessChemo$rx)){
Tx3[i]<-ifelse(ptProcessChemo$tr[i]>=500, ptProcessChemo$rx[i]*1, 0)
}
ptProcessChemo<-cbind(ptProcessChemo, as.numeric(unlist(Tx1)),  as.numeric(unlist(Tx2)),  as.numeric(unlist(Tx3)))
colnames(ptProcessChemo)<-c("subject", "rx", "status", "survt", "r", "tr", "dir", "yir","Time1", "Time2", "Time3")
head(ptProcessChemo)
poissonChemo3<-glm(yir ~ I(as.factor(r)) + Time1 + Time2 + Time3 + offset(I(log(dir))), family=poisson(link = "log"), data=ptProcessChemo)
summary(poissonChemo3)
ptProcessChemo <- ddply(.data=dsChemo,.variables=.(subject),.fun = createPTable)
head(ptProcessChemo)
ptProcessChemo$Time1 <- ifelse(ptProcessChemo$tr<250, ptProcessChemo$rx*1, 0)
ptProcessChemo$Time2 <- ifelse(250<=ptProcessChemo$tr & ptProcessChemo$tr<500, ptProcessChemo$rx*1, 0)
ptProcessChemo$Time3 <- ifelse(ptProcessChemo$tr>=500, ptProcessChemo$rx*1, 0)
head(ptProcessChemo)
poissonChemo3<-glm(yir ~ I(as.factor(r)) + Time1 + Time2 + Time3 + offset(I(log(dir))), family=poisson(link = "log"), data=ptProcessChemo)
summary(poissonChemo3)
