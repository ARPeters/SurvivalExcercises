{
    "contents" : "rm(list=ls(all=TRUE))\n#load necessary packages\nlibrary(survival)\n\n\n#Ch2 Test Question 1\n#Using the vets.dat data set described in the presentation:\n# File layout\n# Column 1: Treatment (standard = 1, test = 2)\n# Column 2: Cell type 1 (large = 1, other = 0)\n# Column 3: Cell type 2 (adeno = 1, other = 0)\n# Column 4: Cell type 3 (small = 1, other = 0)\n# Column 5: Cell type 4 (squamous = 1, other = 0)\n# Column 6: Survival time (days)\n# Column 7: Performance Status (0 = worst . . . 100 = best)\n# Column 8: Disease duration (months)\n# Column 9: Age\n# Column 10: Prior therapy (none = 0, some = 1)\n# Column 11: Status (0 = censored, 1 = died)\n\n#a.  Obtain KM plots for the two categories of the variable cell type 1 ( 1 = large, 0 = other).\n#    Comment on how the two curves compare with each other.\n#    Carry out the log-rank, and draw con clusions from the test(s).\n\n#Read in dataset\nch2test1 <- read.table(\"S:\\\\CCAN\\\\CCANResEval\\\\Methods & Stat Training\\\\Thomas\\\\Survival Analysis\\\\Data Files\\\\vets.txt\")\n\n#Split columns\nnewNames <- c(\"treatment\",\"large\",\"adeno\",\"small\",\"squamous\")\nany(!sapply(strsplit(as.character(ch2test1$V1),\"\"),function(x) sum(nchar(x))) == 5) #check that all v1 rows have 5 characters\nch2test1[,newNames] <- t(sapply(strsplit(as.character(ch2test1$V1),\"\"),function(x) x))\n# ch2test1$large     <- sapply(strsplit(as.character(ch2test1$V1),\"\"),function(x) x[2])\n# ch2test1$adeno     <- sapply(strsplit(as.character(ch2test1$V1),\"\"),function(x) x[3])\n# ch2test1$small     <- sapply(strsplit(as.character(ch2test1$V1),\"\"),function(x) x[4])\n# ch2test1$squamous  <- sapply(strsplit(as.character(ch2test1$V1),\"\"),function(x) x[5])\n\n\n#Delete 1st Column and reorder columns\nch2test1 <- ch2test1[, c(8:12, 2:7) ]\n\n#Rename remaining columns\nnames(ch2test1)[6]  <- \"survivaltime\"\nnames(ch2test1)[7]  <- \"performancestatus\"\nnames(ch2test1)[8]  <- \"diseaseduration\"\nnames(ch2test1)[9]  <- \"age\"\nnames(ch2test1)[10] <- \"priortherapy\"\nnames(ch2test1)[11] <- \"censorstatus\"\n\n#KM plots for cell type 1 (large)\n#is this giving the survival plot and the confidence intervals?\nsObj <- Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)\nsummary(survfit(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~1))\nkmfit1 <- survfit(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~1)\nplot(kmfit1)\n\n#KM plots for cell type 1 (large)\nSurv(ch2test1$survivaltime, ch2test1$censorstatus==1)\nsummary(survfit(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~ch2test1$large))\nkmfit2 <- survfit(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~ch2test1$large)\nplot(kmfit2, col=c(\"black\", \"blue\"))\n\nsurvdiff(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~ch2test1$large)\n\n#b.  Obtain KM plots for the four categories of cell type-large, adeno, small, and squamous.  \n#    Note that you will need to recode the data to define a single variable which numerically distinguishes the four categories (e.g., 1 = large, 2= adeno, etc.)\n#    As in part a, compare the four KM curves.  Also carry out the log-rank for the equality of the four cuves and draw conclusions.\n\n#Creating New Variable celltype\n\nch2test1$celltype <- ifelse(ch2test1$large==1, 1, ifelse(ch2test1$adeno==1, 2, ifelse(ch2test1$small==1, 3, ifelse(ch2test1$squamous==1, 4, 0))))\n\n\n#KM plots for all cell types\nSurv(ch2test1$survivaltime, ch2test1$censorstatus==1)\nsummary(survfit(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~ch2test1$celltype))\nkmfit3 <- survfit(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~ch2test1$celltype)\nplot(kmfit3, col=c(\"black\", \"red\", \"green\", \"blue\"))\n\n\nsurvdiff(Surv(ch2test1$survivaltime, ch2test1$censorstatus==1)~ch2test1$celltype)\n\n\n\n\n\n\n\n\n\n",
    "created" : 1418147128894.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4138886222",
    "id" : "D3C1BF85",
    "lastKnownWriteTime" : 1413296092,
    "path" : "~/GitHub/SurvivalExercises/Thomas/Survival Analysis/Assignments/ch2test1.R",
    "project_path" : "Thomas/Survival Analysis/Assignments/ch2test1.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}