{
    "contents" : "library(survival)\nlibrary(foreign)\n\nrm(list=ls(all=TRUE))\n################################\n# CHAPTER 8 Test\n################################\n\n################################\n# Question 1\n################################\n\n# Suppose that Bonnie (B) and Lonnie (L) are th only two subjects in the dataset shown below, wher both subjects have two\n# recurrent events that occur ar different times.\n\n# ID  Status  Stratum Start Stop\n# B   1       1       0     12\n# B   1       2       12    16\n# L   1       1       0     20\n# L   1       2       20    23\n\n################################\n# A \n################################\n\n# Fill in the empty cells in the following data layout describing survival time (say, in weeks) to the first event (stratum 1):\n\n# Answer\n\n# t(f)    nf    mf    qf    R(t(f))\n# 0       2     0     0     {B, L}\n# 12      2     1     0     {B, L}\n# 20      1     1     0     {L}\n\n################################\n# B \n################################\n\n#Why will the layout given in part a be the same regardless of whether rhe analysis approach is the Counting Process (CP), \n# Stratified CP, Gap Time, or Marginal approaches?\n\n# Answer\n\n# Regardless of the approach, the observation for the first events are identical.\n\n################################\n# C \n################################\n\n# Fill in the empty cells in the following data layout describing survival time (say, in weeks) from the first to the \n# second event (stratum 2) using the Stratified CP approach:\n\n# Answer\n\n# t(f)    nf    mf    qf    R((f))\n# 0       0     0     0     -\n# 16      1     1     0     {B}\n# 23      1     1     0     {L}\n\n################################\n# D\n################################\n\n# Fill in the empty cells in the following data layout describing survival time (say, in weeks) from the first to \n# the second event (stratum 2) using the Gap Time approach:\n\n# Answer\n\n# t(f)    nf    mf    qf    R((f))\n# 0       2     0     0     {B, L}\n# 3       2     1     0     {B, L}\n# 4       1     1     0     {B}\n\n################################\n# E\n################################\n\n# Fill in the empty cells in the following data layout describiing survival time (say, in weeks) from the\n# first to the second event (stratum 2) using the Marginal approach:\n\n# t(f)    nf    mf    qf    R((f))\n# 0       2     0     0     {B, L}\n# 16      2     1     0     {B, L}\n# 23      1     1     0     {L}\n\n################################\n# F\n################################\n\n# For the Stratified CP approach described in part c,determine which of the following choices is correct. Circle the number \n# corresponding to the one and only one correct choice.\n\n# i. Lonnie is in the risk set when Bonnie gets her second event.\n# ii. Bonnie is in the risk set when Lonnie gets her second event.\n# iii. Neither is in the risk set for the other’s second event.\n\n# Answer \n\n# Choice iii.\n# Bonnie is at risk for a 2nd event from time 12 to 16\n# Lonnie is at risk from time 20 to 23.\n# There is no overlap in their risk set.\n\n################################\n# G\n################################\n\n# For the Gap Time approach described in part d, determine which of the following choices is correct.\n# Circle the number corresponding to the one and only one correct choice.\n\n# i. Lonnie is in the risk set when Bonnie gets her second event.\n# ii. Bonnie is in the risk set when Lonnie gets her second event.\n# iii. Neither is in the risk set for the other’s second event.\n\n# Answer\n\n# Choice ii\n# Bonnie is at risk between times 0 to 4\n# Lonnie is a trisk between times 0 to 3\n# Bonnie is in the risk set during the time when Lonnie gets her 2nd event.\n\n################################\n# H\n################################\n\n# For the Marginal approach described in part e, determine which of the following choices is correct.\n# Circle the number corresponding to the one and only one correct choice.\n\n# i. Lonnie is in the risk set when Bonnie gets her second event.\n# ii. Bonnie is in the risk set when Lonnie gets her second event.\n# iii. Neither is in the risk set for the other’s second event.\n\n# Answer\n\n# Choice i\n# Bonnie is at risk between times 0 to 16\n# Lonnie is at risk between times 0 to 23\n# Lonnie is i the risk set when Bonnie gets her 2nd event\n\n################################\n# Question 2\n################################\n\n# The dataset shown below in the counting process layout comes from a clinical trial involving 36 heart attack\n# patients between 40 and 50 years of age with implanted defibrillators who were randomized to one of two treatment\n# groups (tx, ¼ 1 if treatment A, ¼ 0 if treatment B) to reduce their risk for future heart attacks over a \n# 4-month period. The event of interest was experiencing a “high energy shock” from the defibrillator. The outcome\n# is time (in days) until an event occurs. The covariate of interest was Smoking History \n# (1 ¼ ever smoked, 0 ¼ never smoked). Questions about the analysis of this dataset follow.\n\n#Col 1 = id, Col 2 = event, Col 3 = start, Col 4  stop, Col 5 = tx, Col 6 = smoking\n\ndsCh8Test2 <- c(\"01 1 0 39 0 0 12 1 0 39 0 1\n01 1 39 66 0 0 12 1 39 80 0 1\n01 1 66 97 0 0 12 0 80 107 0 1\n02 1 0 34 0 1 13 1 0 36 0 1\n02 1 34 65 0 1 13 1 36 64 0 1\n02 1 65 100 0 1 13 1 64 95 0 1\n03 1 0 36 0 0 14 1 0 46 0 1\n03 1 36 67 0 0 14 1 46 77 0 1\n03 1 67 96 0 0 14 0 77 111 0 1\n04 1 0 40 0 0 15 1 0 61 0 1\n04 1 40 80 0 0 15 1 61 79 0 1\n04 0 80 111 0 0 15 0 79 111 0 1\n05 1 0 45 0 0 16 1 0 57 0 1\n05 1 45 68 0 0 16 0 57 79 0 1\n05 . 68 . 0 0 16 . 79 . 0 1\n06 1 0 33 0 1 17 1 0 37 0 1\n06 1 33 66 0 1 17 1 37 76 0 1\n06 1 66 96 0 1 17 0 76 113 0 1\n07 1 0 34 0 1 18 1 0 58 0 1\n07 1 34 67 0 1 18 1 58 67 0 1\n07 1 67 93 0 1 18 0 67 109 0 1\n08 1 0 39 0 1 19 1 0 58 1 1\n08 1 39 72 0 1 19 1 58 63 1 1\n08 1 72 102 0 1 19 1 63 106 1 1\n09 1 0 39 0 1 20 1 0 45 1 0\n09 1 39 79 0 1 20 1 45 72 1 0\n09 0 79 109 0 1 20 1 72 106 1 0\n10 1 0 36 0 0 21 1 0 48 1 0\n10 1 36 65 0 0 21 1 48 81 1 0\n10 1 65 96 0 0 21 1 81 112 1 0\n11 1 0 39 0 0 22 1 0 38 1 1\n11 1 39 78 0 0 22 1 38 64 1 1\n11 1 78 108 0 0 22 1 64 97 1 1\n23 1 0 51 1 1 30 1 0 57 1 0\n23 1 51 69 1 1 30 1 57 78 1 0\n23 0 69 98 1 1 30 1 78 99 1 0\n24 1 0 43 1 1 31 1 0 44 1 1\n24 1 43 67 1 1 31 1 44 74 1 1\n24 0 67 111 1 1 31 1 74 96 1 1\n25 1 0 46 1 0 32 1 0 38 1 1\n25 1 46 66 1 0 32 1 38 71 1 1\n25 1 66 110 1 0 32 1 71 105 1 1\n26 1 0 33 1 1 33 1 0 38 1 1\n26 1 33 68 1 1 33 1 38 64 1 1\n26 1 68 96 1 1 33 1 64 97 1 1\n27 1 0 51 1 1 34 1 0 38 1 1\n27 1 51 97 1 1 34 1 38 63 1 1\n27 0 97 115 1 1 34 1 63 99 1 1\n28 1 0 37 1 0 35 1 0 49 1 1\n28 1 37 79 1 0 35 1 49 70 1 1\n28 1 79 93 1 0 35 0 70 107 1 1\n29 1 0 41 1 1 36 1 0 34 1 1\n29 1 41 73 1 1 36 1 34 81 1 1\n29 0 73 111 1 1 36 1 81 97 1 1\")\n                \ndsCh8Test2 <- data.frame(matrix(as.numeric(unlist(strsplit(dsCh8Test2,split=\"\\\\s|\\\\n\"))),ncol=6,byrow=T))\ncolnames(dsCh8Test2) <- c(\"id\",\"event\",\"start\",\"stop\",\"tx\",\"smoking\")\n\ndsCh8Test2Final <- dsCh8Test2[order(dsCh8Test2$id,dsCh8Test2$start),]\nrm(dsCh8Test2)\n\n#CP Approach\ncpApproach <- coxph(data=dsCh8Test2Final, Surv(time=start, time2=stop,event=event==1) ~ tx+smoking+cluster(id),ties=\"breslow\")\nsummary(cpApproach)\n\n#Stratified CP approach\ndsCh8Test2Final$event <- rep(1:3,36)\nstratcpApproach <- coxph(data=dsCh8Test2Final, Surv(time=start, time2=stop,event=event==1) ~ tx+smoking+cluster(id)+strata(event),ties=\"breslow\")\nsummary(stratcpApproach)\n\n#Gap approach\ndsCh8Test2Final$gapTime <- dsCh8Test2Final$stop - dsCh8Test2Final$start\nhead(dsCh8Test2Final)\ngapApproach <- coxph(data=dsCh8Test2Final, Surv(time=gapTime,event=event==1) ~ tx+smoking+cluster(id)+strata(event),ties=\"breslow\")\nsummary(gapApproach)\n\n################################\n# A\n################################\n\n# State the hazard function formula for the nointeraction model used to fit the CP approach.\n\n# Answer\n\n# h(t, X) = h0(t)exp[Btx + ysmoking]\n\n# tx = 1 if treatment A, 0 if trt B\n# Smoking status = 1 if ever smoke, 0 if never smoke\n\n################################\n# B\n################################\n\n# Based on the CP approach, what do you conclude about the effect of treatment (tx)? Explain briefly using the results in Table T.1.\n\n# Answer\n\n# There is no significatn effect of trt status adjusted for smoking.  \n# HR = 1.087\n# P-Value = .4182\n\n################################\n# C\n################################\n\n# State the hazard function formulas for the no-interaction and interaction SC models corresponding to the use of \n# the Marginal approach for fitting these data.\n\n# Answer\n\n# Interaction Model\n# hb{t, X} = h0g(t)exp[Bgtx + ygsmoking], g = 1, 2, 3\n\n# No-Interaction Model\n# hb{t, X} = h0g(t)exp[Btx + ysmoking], g = 1, 2, 3\n\n################################\n# D\n################################\n\n# Table T.1 gives results for “no-interaction” SC models because likelihood ratio (LR) tests comparing a “no-interaction” \n# with an “interaction” SC model were not significant. Describe the (LR) test used for the marginal model (full and reduced models,\n# null hypothesis, test statistic, distribution of test statistic under the null).\n\n# Answer\n\n# LR = -2lnLR-(-21nLF)\n# Approx x^2 with 4df\n\n# H0: no-interaction SC model is appropriate, whereR denotes the reduced (no interaction SC) model and F denotes the full (interaction SC) model\n\n################################\n# E\n################################\n\n# How can you criticize the use of a no-interaction SC model for any of the SC approaches, despite the finding that the \n# above likelihood ratio test was not significant?\n\n# Answer\n\n# The use ofa non-interactionmodel does not allow you to obtain stratum-specific HR estimates, even when you assume strata are important.\n\n################################\n# F\n################################\n\n# Based on the study description given earlier, why does it make sense to recommend the CCP approach\n# over the other alternative approaches?\n\n# Answer\n\n# The CP approach makes sence because the recurrent events on teh same subject (defibrillator shock) are the same types of events\n# regardless of when they occurred.\n\n################################\n# G\n################################\n\n# Under what circumstances/assumptions would you recommend using the Marginal approach instead of the CP approach?\n\n# Answer\n\n# The marginal approach would be used if you determined that the recurrent events on the same subject were different.\n\n################################\n# H\n################################\n\n# In Table T.2, why does the number in the risk set (nf) remain unchanged through failure time (i.e., day) 68, \n# even though 50 events occur up to that time?\n\n# Answer\n\n# The number in the risk set remains unchanged because the subjects who had already failed by this time were still at risk for a \n# subsequent event.\n\n################################\n# I\n################################\n\n# Why does the number in the risk set change from 31 to 26 when going from time 96 to 97?\n\n# Answer\n\n# Subjects 9, 15, and 28 fail for the second time at 79 days, subject #16 is censored at 79 days.\n\n################################\n# J\n################################\n\n# Why is the number of failures (mf) equal to 3 and the number of censored subjects equal to 1 in the interval\n# between failure times 79 and 80?\n\n# Answer\n\n# Subjects 3,6, 10,26, and 31 all fail for the third time at day 98 and are not followed afterwards.\n\n################################\n# K\n################################\n\n# What 5 subjects were censored in the interval between failure times 111 and 112?\n\n# Answer\n\n# Subjects 4, 14, 15, 24, and 29\n\n################################\n# L\n################################\n\n# Describe the event history for subject #5, including his or her effect on changes in the risk set.\n\n# Answer\n\n# First event at 45 days\n# Second event at 68 days\n# Drops out of study at 68 days\n# causes the risk set to change from 36 to 35 after 68 days.\n\n################################\n# M\n################################\n\n# What is being plotted by such a curve? (Circle one or more choices.)\n\n# i. Pr(T1 > t) where T1 = time to first event from study entry.\n# ii. Pr(T > t) where T = time from any event to the next recurrent event.\n# iii. Pr(T > t) where T = time to any event from study entry.\n# iv. Pr(not failing prior to time t).\n# v. None of the above.\n\n# Answer\n\n# v. None of the above.\n\n################################\n# N\n################################\n\n# Can you criticize the use of the product limit formula for S(t(f)) in Table T.3? Explain briefly.\n\n# Answer\n\n# Product limit formula does not apply to CP data\n\n\n################################\n# O\n################################\n\n# Use Table T.2 to complete the data layouts for plotting the following survival curves.\n\n# i. S1(t) ¼ Pr(T1 > t) where T1 ¼ time to first event from study entry\n\n\n# t(f) nf mf qf S(t(f)) = S(t(f1))  Pr(T1 > t|T1 \f t)\n# 0    36 0  0  1.00\n# 33   36 2  0  0.94\n# 34   34 3  0  0.86\n# 36   31 3  0  0.78\n# 37   28 2  0  0.72\n# 38   26 4  0  0.61\n# 39   22 5  0  0.47\n# 40   17 1  0  0.44\n# 41   16 1  0  0.42\n# 43   15 1  0  0.39\n# 44   14 1  0  0.36\n# 45   13 2  0  0.31\n# 46   11 2  0  0.25\n# 48   9  1  0  0.22\n# 49   8  1  0  0.19\n\n# 51   7  2  0  .19 * 5/7 = .14\n# 57   5  2  0  .14 * 3/5 = .08\n# 58   3  2  0  .08 * 1/3 = .03\n# 61   1  1  0  .03 * 0/1 = 0\n\n# ii. Gap Time S2c(t) = Pr(T2c > t) where T2c = time to second event from first event.\n\n# t(f) nf mf qf S(t(f)) = S(t(f1))  Pr(T1 > t|T1 \f t)\n# 0    36 0  0  1.00\n# 5    36 1  0  0.97\n# 9    35 1  0  0.94\n# 18   34 2  0  0.89\n# 20   32 1  0  0.86\n# 21   31 2  1  0.81\n# 23   28 1  0  0.78\n# 24   27 1  0  0.75\n# 25   26 1  0  0.72\n# 26   25 2  0  0.66\n# 27   23 2  0  0.60\n# 28   21 1  0  0.58\n# 29   20 1  0  0.55\n# 30   19 1  0  0.52\n# 31   18 3  0  0.43  \n# 32   15 1  0  0.40\n# 33   14 5  0  0.26  \n# 35   9  1  0  0.23  \n# 39   8  2  0  0.17\n\n# 40\n# 41\n# 42\n# 46\n# 47\n\n#???????????????????????????????????????????????????????????????????\n\n# Marginal S2m(t) = Pr(T2m > t) where T2m = time to second event from study entry.\n\n# t(f) nf mf qf S(t(f)) = S(t(f 1))  Pr(T1 > t|T1 \f t)\n# 0    36 0  0  1.00\n# 63   36 2  0  0.94                34, 19\n# 64   34 3  0  0.86                13, 22, 33 \n# 65   31 2  0  0.81                2, 10\n# 66   29 3  0  0.72                6, 1, 25 \n# 67   26 4  0  0.61                7, 3, 24, 18 \n# 68   22 2  0  0.56                26, 5\n# 69   20 1  0  0.53                23\n# 70   19 1  0  0.50                35\n# 71   18 1  0  0.47                32\n# 72   17 2  0  0.42                8,20 \n# 73   15 1  0  0.39                29\n# 74   14 1  0  0.36                31\n# 76   13 1  0  0.33                17\n# 77   12 1  0  0.31                14\n# 78   11 2  0  0.25                11, 30\n\n# 79   9  3  1  .25 * 6/9 = .17     28, 9, 16 # 15\n# 80   5  2  0  .17 * 3/5 = .10     12, 4 \n# 81   3  2  0  .10 * 1/3 = .03     21, 36 \n# 97   1  1  0  .03 * 0/1 = 0       27 \n \n\n################################\n# P\n################################\n\n# The survival curves corresponding to each of the data layouts (a, b, c) described in Question 14 will be different. Why?\n\n# Answer\n\n# Simple Answer: they're using different numbers.\n# Less Simple Answer: They are describing different survival functions.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1423580492135.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2127020293",
    "id" : "8B65BB8C",
    "lastKnownWriteTime" : 1427216339,
    "path" : "~/GitHub/SurvivalExercises/Thomas/Survival Analysis/Ch8_Test_Questions_Table_Replication.R",
    "project_path" : "Thomas/Survival Analysis/Ch8_Test_Questions_Table_Replication.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}